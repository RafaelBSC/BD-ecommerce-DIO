-- Quantos pedidos foram feitos por cada cliente?


SELECT 
    c.Fname,
    c.Lname,
    COUNT(o.idOrder) AS total_pedidos
FROM clients c
LEFT JOIN orders o ON c.idClient = o.idOrderClient
GROUP BY c.idClient, c.Fname, c.Lname
ORDER BY total_pedidos DESC;             

-- Algum vendedor também é fornecedor?


SELECT 
    s.SocialName AS nome_vendedor,
    sup.SocialName AS nome_fornecedor
FROM seller s
INNER JOIN supplier sup
    ON s.CNPJ IS NOT NULL 
    AND s.CNPJ = sup.CNPJ;

-- Relação de produtos fornecedores e estoques


SELECT 
    p.Pname AS produto,
    sup.SocialName AS fornecedor,
    ps.quantity AS quantidade_fornecedor,
    psStorage.quantity AS quantidade_estoque,
    psStorage.storageLocation AS local_estoque
FROM product p
INNER JOIN productSupplier ps ON p.idProduct = ps.idPsProduct
INNER JOIN supplier sup ON ps.idPsSupplier = sup.idSupplier
LEFT JOIN productStorage psStorage ON psStorage.idProdStorage IN (
    SELECT idLstorage FROM storageLocation sl WHERE sl.idLproduct = p.idProduct
)
ORDER BY p.Pname;

-- Relação de nomes dos fornecedores e nomes dos produtos


SELECT 
    sup.SocialName AS fornecedor,
    p.Pname AS produto
FROM supplier sup
INNER JOIN productSupplier ps ON sup.idSupplier = ps.idPsSupplier
INNER JOIN product p ON ps.idPsProduct = p.idProduct
ORDER BY sup.SocialName, p.Pname;